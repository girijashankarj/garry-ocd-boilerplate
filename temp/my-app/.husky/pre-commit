#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

RED="\033[0;31m"
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
BLUE="\033[0;34m"
NC="\033[0m"

echo "${BLUE}==> Pre-commit: branch validation${NC}"
node scripts/precommit/validate-branch.js || { echo "${RED}Branch validation failed.${NC}"; exit 1; }
echo "${GREEN}Branch validation passed.${NC}"

echo "${BLUE}==> Pre-commit: changeset check${NC}"
node scripts/precommit/ensure-changeset.js || { echo "${RED}Missing changeset. Run npx changeset and stage it.${NC}"; exit 1; }
echo "${GREEN}Changeset check passed.${NC}"

echo "${BLUE}==> Pre-commit: lint (auto-fix)${NC}"
npm run lint:fix || { echo "${RED}Lint failed.${NC}"; exit 1; }
echo "${GREEN}Lint passed.${NC}"

echo "${BLUE}==> Pre-commit: format (auto-fix)${NC}"
npm run format:fix || { echo "${RED}Format failed.${NC}"; exit 1; }
echo "${GREEN}Format passed.${NC}"

echo "${BLUE}==> Pre-commit: tests with coverage${NC}"
npm run test:coverage || { echo "${RED}Tests failed.${NC}"; exit 1; }
echo "${GREEN}Tests passed.${NC}"
